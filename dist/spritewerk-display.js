var SW={};
SW.Util=function(){"use strict";var r=function(){};return r.prototype.clone=function(r){var t,n="object"==typeof r&&r.hasOwnProperty("length")?[]:{};for(t in r)n[t]="object"==typeof r[t]&&null!==r[t]?this.clone(r[t]):r[t];return n},r.prototype.mixin=function(r){var t,n,o=arguments.length;if(2>o)throw new Error("Util.mixin requires two or more arguments");for(var e=1;o>e;e+=1){t=this.clone(arguments[e]);for(n in t)r[n]=t[n]}return r},r.prototype.hasMembers=function(r){var t=0;for(var n in r)if(t++,t)break;return t?!0:!1},r.prototype.hitPoint=function(r,t,n){var o=n.position(),e=n.dimensions();return r>=o.x&&r<=o.x+e.x&&t>=o.y&&t<=o.y+e.y?!0:!1},new r}();
SW.Unique=function(){"use strict";var i=0,n=function(){this._uid=++i};return n}();
SW.Collection=function(){"use strict";var t=function(){SW.Unique.call(this),this._items=[]};return t.prototype=SW.Util.clone(SW.Unique.prototype),t.prototype.addItem=function(t,e){return this._items.push({name:t,value:e}),this},t.prototype.addItemAt=function(t,e,i){return this._items.splice(i,0,{name:t,value:e}),this},t.prototype.removeItem=function(t){this._rawEach(function(e,i,n,o){return t===n?(e=null,o.splice(i,1),!1):void 0})},t.prototype.removeAllItems=function(){return this._items=[],this},t.prototype.each=function(t,e){var i;t=e?t.bind(e):t;for(var n=0,o=this._items.length;o>n&&(i=this._items[n],t(i.value,n,i.name)!==!1);n+=1);},t.prototype._rawEach=function(t){for(var e=0,i=this._items.length;i>e&&t(this._items[e],e,this._items[e].name,this._items)!==!1;e+=1);},t.prototype.filter=function(t,e){var i,n=[];return this.each(function(e,o,r){i=t(e,o,r),i&&n.push(i)},e),n},t.prototype.getItemCount=function(){return this._items.length},t.prototype.setItem=function(t,e){return this._rawEach(function(i,n,o){return t===o?(i.value=e,!1):void 0}),this},t.prototype.getItem=function(t){var e;return this.each(function(i,n,o){return t===o?(e=i,!1):void 0}),e},t.prototype.getItemAt=function(t){return this._items[t].value},t.prototype._getRawItem=function(t){var e;return this._rawEach(function(i,n,o){return t===o?(e=i,!1):void 0}),e},t.prototype.setItemIndex=function(t,e){var i,n=this.getItemIndex(t);e!==n&&(i=this._getRawItem(t),this.removeItem(t),this._items.splice(e,0,i))},t.prototype.getItemIndex=function(t){var e;return this.each(function(i,n,o){return t===o?(e=n,!1):void 0}),e},t}();
SW.Dom=function(){"use strict";var e=function(e){e=e||{},this.title=e.title,this.frameColor=e.frameColor||"#444",document.title=this.title||"spritewerk game",this._styleElements(),SW.Signal.addListener(window,"resize",this._onWindowResize,this),SW.Signal.addListener(window,"orientationchange",this._onWindowResize,this)};return e.prototype._onWindowResize=function(){SW.Signal.dispatch("screen/resize")},e.prototype._styleElements=function(){var e=document.getElementsByTagName("body")[0];e.style.backgroundColor=this.bgColor,e.style.margin=0,e.style.padding=0},e}();
SW.Canvas=function(){"use strict";var t=function(t){t=t||{},this._canvasEl=document.getElementById(t.id),this._context=this._canvasEl.getContext("2d"),this._width=t.width||800,this._height=t.height||600,this._canvasEl.width=this._width,this._canvasEl.height=this._height,this._canvasEl.style.position="absolute",t.canvasFit&&(SW.Signal.addListener("screen/resize",this._onScreenResize,this),this._onScreenResize())};return t.prototype._onScreenResize=function(){var t,e,i=this._height/this._width,n=this._width/this._height,o=n>i?!0:!1,s=window.innerWidth,h=window.innerHeight,r=h/s,a=s/h,c=0,l=0;o?r>i?(t=s,e=t*i,l=(h-e)/2):(e=h,t=h*n,c=(s-t)/2):a>n?(e=h,t=h*n,c=(s-t)/2):(t=s,e=t*i,l=(h-e)/2),this._canvasEl.style.width=Math.round(t)+"px",this._canvasEl.style.height=Math.round(e)+"px",this._canvasEl.style.left=Math.round(c)+"px",this._canvasEl.style.top=Math.round(l)+"px"},t.prototype.clearAll=function(){return this._context.clearRect(0,0,this._width,this._height),this},t.prototype.fillAll=function(t){return this._context.save(),this._context.fillStyle=t,this._context.fillRect(0,0,this._width,this._height),this._context.restore(),this},t.prototype.render=function(t){var e=t.getPosition(),i=t.getScale(),n=t.getRotation(),o=t.getRotationOffset(),s=t.getScaleOffset();switch(this._context.save(),this._context.translate(Math.floor(e.x),Math.floor(e.y)),0!==n&&(this._context.translate(o.x,o.y),this._context.rotate(Math.PI/180*n),this._context.translate(-o.x,-o.y)),(1!==i.x||1!==i.y)&&(this._context.translate(s.x,s.y),this._context.scale(i.x,i.y),this._context.translate(-s.x,-s.y)),this._context.globalAlpha=t.getOpacity(),this._context.globalCompositeOperation=t.getComposite(),t.getDisplayType()){case"rectangle":this._renderRectangle(t);break;case"line":this._renderLine(t);break;case"polygon":this._renderPolygon(t);break;case"sprite":this._renderSprite(t);break;case"text":this._renderText(t);break;default:throw new Error("SW.Canvas cannot render type: "+t.getDisplayType())}this._context.restore()},t.prototype._renderRectangle=function(t){var e=t.getDimensions(),i=t.getFillStyle(),n=t.getStrokeStyle();this._context.save(),this._context.lineWidth=t.getStrokeWidth(),i&&(this._context.fillStyle=i,this._context.fillRect(0,0,e.x,e.y)),n&&(this._context.strokeStyle=n,this._context.strokeRect(0,0,e.x,e.y)),this._context.restore()},t.prototype._renderLine=function(t){var e=t.getCoordinates();this._context.save(),this._context.strokeStyle=t.getStrokeStyle(),this._context.lineWidth=t.getStrokeWidth(),this._context.beginPath(),this._context.moveTo(e[0].x,e[0].y);for(var i=1,n=e.length;n>i;i+=1)this._context.lineTo(e[i].x,e[i].y);this._context.stroke(),this._context.restore()},t.prototype._renderPolygon=function(t){var e=t.getCoordinates(),i=t.getDillStyle(),n=t.getStrokeStyle();this._context.save(),this._context.lineWidth=t.getStrokeWidth(),this._context.beginPath(),this._context.moveTo(e[0].x,e[0].y);for(var o=1,s=e.length;s>o;o+=1)this._context.lineTo(e[o].x,e[o].y);this._context.lineTo(e[0].x,e[0].y),this._context.closePath(),i&&(this._context.fillStyle=i,this._context.fill()),n&&(this._context.strokeStyle=n,this._context.stroke()),this._context.restore()},t.prototype._renderText=function(t){var e,i,n,o=t.getFillStyle(),s=t.getStrokeStyle(),h=t.getMaxWidth(),r=t.getContents();this._context.save(),this._context.font=t.getFont(),this._context.textBaseline=t.getBaseline(),this._context.textAlign=t.getAlign(),this._context.lineWidth=t.getStrokeWidth(),"number"==typeof h?(i=this._getWrappedText(r,h),e=this._getLineHeight(t)):i[0]=r;for(var a=0,c=i.length;c>a;a+=1)o&&(this._context.fillStyle=o,this._context.fillText(i[a],0,e*a)),s&&(this._context.strokeStyle=s,this._context.strokeText(i[a],0,e*a));n=this._context.measureText(r),t.setDimensions(h||n.width,e*i.length),this._context.restore()},t.prototype._getWrappedText=function(t,e){for(var i,n,o=t.split(" "),s=[],h="",r=0,a=o.length;a>r;r+=1)i=h+o[r]+" ",n=this._context.measureText(i).width,n>e?(s.push(h),h=o[r]+" "):h=i;return s.push(h),s},t.prototype._getLineHeight=function(t){var e=1.2,i=t.getFont();return parseInt(i.match(/[0-9]*px|pt|em/),10)*e},t.prototype._renderSprite=function(t){var e=t.getDimensions(),i=t.getSrcDimensions(),n=t.getSrcPosition();this._context.drawImage(t.getImage(),n.x,n.y,i.x,i.y,0,0,e.x,e.y)},t.prototype.getCanvasEl=function(){return this._canvasEl},t.prototype.getContext=function(){return this._context},t}();
SW.Vector=function(){"use strict";var t=function(t,e){this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0};return t}();
SW.Renderable=function(){"use strict";var t=function(){SW.Unique.call(this),this._position=new SW.Vector,this._velocity=new SW.Vector,this._dimensions=new SW.Vector,this._scale=new SW.Vector(1,1),this._rotationOffset=new SW.Vector,this._scaleOffset=new SW.Vector,this._draggable=!1,this._rotation=0,this._opacity=1,this._fillStyle="#999",this._strokeStyle=null,this._strokeWidth=4,this._visible=!0,this._hidden=!1,this._composite="source-over",this._displayType=""};return t.prototype=SW.Util.clone(SW.Unique.prototype),t.prototype.getDisplayType=function(){return this._displayType},t.prototype.getPosition=function(){return this._position},t.prototype.setPosition=function(t,e){return"number"==typeof t&&(this._position.x=t),"number"==typeof e&&(this._position.y=e),this},t.prototype.getDimensions=function(){return this._dimensions},t.prototype.setDimensions=function(t,e){return"number"==typeof t&&(this._dimensions.x=t),"number"==typeof e&&(this._dimensions.y=e),this},t.prototype.getRotation=function(){return this._rotation},t.prototype.setRotation=function(t){this._rotation=t},t.prototype.getRotationOffset=function(){return this._rotationOffset},t.prototype.setRotationOffset=function(t,e){return"number"==typeof t&&(this._rotationOffset.x=t),"number"==typeof e&&(this._rotationOffset.y=e),this},t.prototype.getScale=function(){return this._scale},t.prototype.setScale=function(t,e){return"number"==typeof t&&(this._scale.x=t),"number"==typeof e&&(this._scale.y=e),this},t.prototype.getScaleOffset=function(){return this._scaleOffset},t.prototype.setScaleOffset=function(t,e){return"number"==typeof t&&(this._scaleOffset.x=t),"number"==typeof e&&(this._scaleOffset.y=e),this},t.prototype.getDraggable=function(){return this._draggable},t.prototype.setDraggable=function(t){return this._draggable=t,this},t.prototype.getOpacity=function(){return this._opacity},t.prototype.setOpacity=function(t){return this._opacity=t,this},t.prototype.getComposite=function(){return this._composite},t.prototype.setComposite=function(t){return this._composite=t,this},t.prototype.getFillStyle=function(){return this._fillStyle},t.prototype.setFillStyle=function(t){return this._fillStyle=t,this},t.prototype.getStrokeStyle=function(){return this._strokeStyle},t.prototype.setStrokeStyle=function(t){return this._strokeStyle=t,this},t.prototype.getStrokeWidth=function(){return this._strokeWidth},t.prototype.setStrokeWidth=function(t){return this._strokeWidth=t,this},t.prototype.getOuterPosition=function(){return new SW.Vector(this._position.x+this._dimensions.x,this._position.y+this._dimensions.y)},t.prototype.getCenterPosition=function(){return new SW.Vector(this._position.x-this._dimensions.x/2,this._position.y-this._dimensions.y/2)},t.prototype.getHalfDimension=function(){return new SW.Vector(this._dimensions.x/2,this._dimensions.y/2)},t}();
SW.Rectangle=function(){"use strict";var e=function(){SW.Renderable.call(this),this._displayType="rectangle"};return e.prototype=SW.Util.clone(SW.Renderable.prototype),e}();
SW.Line=function(){"use strict";var t=function(){SW.Renderable.call(this),this._coordinates=[],this._cap="butt",this._displayType="line"};return t.prototype=SW.Util.clone(SW.Renderable.prototype),t.prototype.getCoordinates=function(){return this._coordinates},t.prototype.setCoordinates=function(){for(var t=0,e=arguments.length;e>t;t+=1)this._coordinates[t]=arguments[t];return this},t.prototype.getCap=function(){return this._cap},t.prototype.setCap=function(t){return this._cap=t,this},t}();
SW.Polygon=function(){"use strict";var t=function(){SW.Renderable.call(this),this._coordinates=[],this._displayType="polygon"};return t.prototype=SW.Util.clone(SW.Renderable.prototype),t.prototype.getCoordinates=function(){return this._coordinates},t.prototype.setCoordinates=function(){for(var t=0,o=arguments.length;o>t;t+=1)this._coordinates[t]=arguments[t];return this},t}();
SW.Sprite=function(){"use strict";var i=function(){SW.Renderable.call(this),this._image=null,this._srcPosition=new SW.Vector,this._srcDimensions=new SW.Vector,this._displayType="sprite"};return i.prototype=SW.Util.clone(SW.Renderable.prototype),i.prototype.getSrcPosition=function(){return this._srcPosition},i.prototype.setSrcPosition=function(i,t){return"number"==typeof i&&(this._srcPosition.x=i),"number"==typeof t&&(this._srcPosition.y=t),this},i.prototype.getSrcDimensions=function(){return this._srcDimensions},i.prototype.setSrcDimensions=function(i,t){return"number"==typeof i&&(this._srcDimensions.x=i),"number"==typeof t&&(this._srcDimensions.y=t),this},i.prototype.setImage=function(i){return"object"==typeof i&&(this._image=i,this._srcDimensions.x||this._srcDimensions.y||(this._srcDimensions.x=this._image.width,this._srcDimensions.y=this._image.height),this._dimensions.x||this._dimensions.y||(this._dimensions.x=this._image.width,this._dimensions.y=this._image.height)),this},i}();
SW.Text=function(){"use strict";var t=function(t){SW.Renderable.call(this,t),t=t||{},this._contents=t.contents||"",this._font="12px sans-serif",this._align="start",this._baseline="top",this._displayType="text",this._maxWidth=null};return t.prototype=SW.Util.clone(SW.Renderable.prototype),t.prototype.getMaxWidth=function(){return this._maxWidth},t.prototype.SetMaxWidth=function(t){return this._maxWidth=t,this},t.prototype.getContents=function(){return this._contents},t.prototype.setContents=function(t){return this._contents=t,this},t.prototype.getFont=function(){return this._font},t.prototype.setFont=function(t){this._font=t},t.prototype.getBaseline=function(){return this._baseline},t.prototype.setBaseline=function(t){return this._baseline=t,this},t.prototype.getAlign=function(){return this._align},t.prototype.setAlign=function(t){this._align=t},t}();