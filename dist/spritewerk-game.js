var SW={};
SW.Util=function(){var n=function(){};return n.prototype.clone=function(n){var t,o="object"==typeof n&&n.hasOwnProperty("length")?[]:{};for(t in n)o[t]="object"==typeof n[t]&&null!==n[t]?this.clone(n[t]):n[t];return o},n.prototype.hasMembers=function(n){var t=0;for(var o in n)if(t++,t)break;return t?!0:!1},n.prototype.hitPoint=function(n,t,o){var r=o.position(),e=o.dimensions();return n>=r.x&&n<=r.x+e.x&&t>=r.y&&t<=r.y+e.y?!0:!1},new n}();
SW.Unique=function(){"use strict";var i=0,n=function(){this._uid=++i};return n}();
SW.Collection=function(){"use strict";var t=function(){SW.Unique.call(this),this._items=[]};return t.prototype=SW.Util.clone(SW.Unique.prototype),t.prototype.addItem=function(t,e){return this._items.push({name:t,value:e}),this},t.prototype.addItemAt=function(t,e,i){return this._items.splice(i,0,{name:t,value:e}),this},t.prototype.removeItem=function(t){this._rawEach(function(e,i,n,o){return t===n?(e=null,o.splice(i,1),!1):void 0})},t.prototype.removeAllItems=function(){return this._items=[],this},t.prototype.each=function(t,e){var i;t=e?t.bind(e):t;for(var n=0,o=this._items.length;o>n&&(i=this._items[n],t(i.value,n,i.name)!==!1);n+=1);},t.prototype._rawEach=function(t){for(var e=0,i=this._items.length;i>e&&t(this._items[e],e,this._items[e].name,this._items)!==!1;e+=1);},t.prototype.filter=function(t,e){var i,n=[];return this.each(function(e,o,r){i=t(e,o,r),i&&n.push(i)},e),n},t.prototype.getItemCount=function(){return this._items.length},t.prototype.setItem=function(t,e){return this._rawEach(function(i,n,o){return t===o?(i.value=e,!1):void 0}),this},t.prototype.getItem=function(t){var e;return this.each(function(i,n,o){return t===o?(e=i,!1):void 0}),e},t.prototype.getItemAt=function(t){return this._items[t].value},t.prototype._getRawItem=function(t){var e;return this._rawEach(function(i,n,o){return t===o?(e=i,!1):void 0}),e},t.prototype.setItemIndex=function(t,e){var i,n=this.getItemIndex(t);e!==n&&(i=this._getRawItem(t),this.removeItem(t),this._items.splice(e,0,i))},t.prototype.getItemIndex=function(t){var e;return this.each(function(i,n,o){return t===o?(e=n,!1):void 0}),e},t}();
SW.Dom=function(){var i=function(){SW.Signal.addListener(window,"resize",this._onWindowResize,this),SW.Signal.addListener(window,"orientationchange",this._onWindowResize,this)};return i.prototype._onWindowResize=function(){SW.Signal.dispatch("screen/resize")},i}();
SW.Signal=function(){var e=function(){this._handlerManager={},this._mediator=document};return e.prototype.addListener=function(e,n,t,r){var a;"string"==typeof e&&"function"==typeof n&&(r=t?t:null,t=n,n=e,e=this._mediator),r&&(this._handlerManager[n]||(this._handlerManager[n]=[]),a={handler:t,boundHandler:t.bind(r)},this._handlerManager[n].push(a)),e.addEventListener(n,a?a.boundHandler:t,!1)},e.prototype.removeListener=function(e,n,t){if("string"==typeof e&&"function"==typeof n&&(t=n,n=e,e=this._mediator),this._handlerManager[n])for(var r=0;r<this._handlerManager[n].length;r+=1)if(t===this._handlerManager[n][r].handler){t=this._handlerManager[n][r].boundHandler,this._handlerManager[n].splice(r,1);break}e.removeEventListener(n,t,!1)},e.prototype.dispatch=function(e,n,t){var r;"string"==typeof e&&"string"!=typeof n&&(t=n,n=e,e=this._mediator),r=new CustomEvent(n,{detail:t}),e.dispatchEvent(r)},new e}();
SW.Input=function(){var t=function(t){var e;if(this._mouseEvents=["click","dblclick","mousedown","mouseup","mousemove"],this._touchEvents=["tap","dbltap","touchstart","touchend","touchmove"],this._eventEl=t.eventEl,this._canvasFit=t.canvasFit,this._pressCandidate=null,this._mouseCanDrag=!1,this._isDragging=!1,this._scene=null,this._layer=null,t.bindMouseInput)for(e=0;e<this._mouseEvents.length;e+=1)SW.Signal.addListener(this._eventEl,this._mouseEvents[e],this._receiveEvent,this);if(t.bindTouchInput)for(e=0;e<this._touchEvents.length;e+=1)SW.Signal.addListener(this._eventEl,this._touchEvents[e],this._receiveEvent,this);SW.Signal.addListener("scene/activated",this.receiveScene,this)};return t.prototype.receiveScene=function(t){this.setScene(t.detail.scene)},t.prototype.setScene=function(t){this._scene=t},t.prototype.setLayer=function(t){this._layer=t},t.prototype._receiveEvent=function(t){var e,s=this._canvasFit?100/this._getScaleFactor()/100:1,i=this._eventEl.offsetLeft,a=this._eventEl.offsetTop,n={domEvent:t},r=[];switch(t.hasOwnProperty("touches")?(n.absX=t.touches[0].pageX-i,n.absY=t.touches[0].pageY-a):(n.absX=t.offsetX||t.clientX-this._eventEl.clientLeft,n.absY=t.offsetY||t.clientY-this._eventEl.clientTop),n.x=n.absX*s,n.y=n.absY*s,n.target=this._getEventTarget(n),t.type){case"click":case"tap":this._pressCandidate&&n.target&&this._pressCandidate._uid===n.target._uid||(n.target=void 0),this._pressCandidate=null,r.push("press");break;case"dblclick":case"dbltap":r.push("dblpress");break;case"mousedown":case"touchstart":this._pressCandidate=n.target,this._dragCandidate=n.target&&n.target.draggable()?n.target:void 0,this._dragCandidate&&(e=this._dragCandidate.position(),this._dragCandidateOffsetX=n.x-e.x,this._dragCandidateOffsetY=n.y-e.y),this._mouseCanDrag=!0,r.push("pressdown");break;case"mouseup":case"touchend":this._mouseCanDrag=!1,this._isDragging&&(this._isDragging=!1,this._dragCandidate=null,r.push("dragend")),r.push("pressup");break;case"mousemove":case"touchmove":this._mouseCanDrag&&this._dragCandidate&&this._dragCandidate.draggable()&&(e=this._dragCandidate.position(),this._dragCandidate.position(n.x-this._dragCandidateOffsetX,n.y-this._dragCandidateOffsetY),this._isDragging||(this._isDragging=!0,r.push("dragstart")),r.push("drag"))}for(var h=0,o=r.length;o>h;h+=1)n.type=r[h],SW.Signal.dispatch(n.type,n)},t.prototype._getScaleFactor=function(){var t,e=1;return this._eventEl.style.width&&(t=parseInt(this._eventEl.style.width,10),e=t/this._eventEl.width),e},t.prototype._getEventTarget=function(t){var e;if(this._scene)this._scene.each(function(s){s.each(function(s){SW.Util.hitPoint(t.x,t.y,s)&&(e=s)})});else{if(!this._layer)throw new TypeError("SW.Input requires one SW.Scenes.Scene or SW.Collection for checking against entities");this._layer.each(function(s){SW.Util.hitPoint(t.x,t.y,s)&&(e=s)})}return e},t}();
SW.Preloader=function(){var e=function(e){var t;this.assets=e,this.total=0,this.loaded=0;for(t in this.assets)this.total+=1;for(t in this.assets)if(this.assets[t].indexOf(".png")>0||this.assets[t].indexOf(".jpg")>0||this.assets[t].indexOf(".gif")>0){var s=new Image;s.src=this.assets[t],SW.Signal.addListener(s,"load",this._loadHandler,this),SW.Signal.addListener(s,"error",this._error,this)}else{if(!(this.assets[t].indexOf(".mp3")>0||this.assets[t].indexOf(".wav")>0||this.assets[t].indexOf(".ogg")>0))throw new Error("File type not supported");var r=new Audio;r.src=this.assets[t],SW.Signal.addListener(r,"canplaythrough",this._loadHandler,this),SW.Signal.addListener(r,"error",this._error,this)}};return e.prototype._loadHandler=function(e){var t,s=e.currentTarget,r=s.tagName.toLowerCase();this._tuneOutCurrent(s),this.loaded+=1;for(var i in this.assets)this._getFileName(this.assets[i])===this._getFileName(s.src)&&(t=i);SW.Signal.dispatch("preload/update",{loaded:this.loaded,total:this.total,name:t,el:s,type:r}),this.loaded===this.total&&SW.Signal.dispatch("preload/complete")},e.prototype._tuneOutCurrent=function(e){var t=e.tagName.toLowerCase();"img"==t?(SW.Signal.removeListener(e,"load",this._loadHandler),SW.Signal.removeListener(e,"error",this._error)):"audio"==t&&(SW.Signal.removeListener(e,"canplaythrough",this._loadHandler),SW.Signal.removeListener(e,"error",this._error))},e.prototype._error=function(e){"console"in window&&console.log(e)},e.prototype._getFileName=function(e){return e.substring(e.lastIndexOf("/")+1,e.length+1)},e}();
SW.MediaManager=function(){"use strict";var t=function(){this._images={},this._sounds={},SW.Signal.addListener("preload/update",this._onUpdate,this)};return t.prototype.preload=function(t){new SW.Preloader(t)},t.prototype._onUpdate=function(t){switch(t.detail.type){case"img":this._images[t.detail.name]=t.detail.el;break;case"audio":this._sounds[t.detail.name]=t.detail.el}},t.prototype._addImage=function(t,e){this._images[t]=e},t.prototype._addSound=function(t,e){this._sounds[t]=e},t.prototype.getImage=function(t){return this._images[t]},t.prototype.playSound=function(t){var e=this._sounds[t];e.currentTime=0,e.play()},t.prototype.pauseSound=function(t){var e=this._sounds[t];e.pause()},t.prototype.resumeSound=function(t){var e=this._sounds[t];e.play()},t.prototype.pauseAllSounds=function(){for(var t in this._sounds)this._sounds[t].pause()},new t}();
SW.Canvas=function(){"use strict";var t=function(t){this._canvasEl=document.getElementById(t.id),this._context=this._canvasEl.getContext("2d"),this._width=t.width,this._height=t.height,this._canvasEl.width=this._width,this._canvasEl.height=this._height,this._canvasEl.style.position="absolute",t.canvasFit&&(SW.Signal.addListener("screen/resize",this._onScreenResize,this),this._onScreenResize())};return t.prototype._onScreenResize=function(){var t,e,i=this._height/this._width,s=this._width/this._height,n=s>i?!0:!1,o=window.innerWidth,h=window.innerHeight,a=h/o,r=o/h,c=0,l=0;n?a>i?(t=o,e=t*i,l=(h-e)/2):(e=h,t=h*s,c=(o-t)/2):r>s?(e=h,t=h*s,c=(o-t)/2):(t=o,e=t*i,l=(h-e)/2),this._canvasEl.style.width=Math.round(t)+"px",this._canvasEl.style.height=Math.round(e)+"px",this._canvasEl.style.left=Math.round(c)+"px",this._canvasEl.style.top=Math.round(l)+"px"},t.prototype.clearAll=function(){return this._context.clearRect(0,0,this._width,this._height),this},t.prototype.fillAll=function(t){return this._context.save(),this._context.fillStyle=t,this._context.fillRect(0,0,this._width,this._height),this._context.restore(),this},t.prototype.render=function(t){var e=t.position(),i=t.scale(),s=t.rotationOffset(),n=t.scaleOffset();switch(this._context.save(),this._context.translate(Math.floor(e.x),Math.floor(e.y)),0!==t.rotation()&&(this._context.translate(s.x,s.y),this._context.rotate(Math.PI/180*t.gsRotation()),this._context.translate(-s.x,-s.y)),(1!==t.scaleX||1!==t.scaleY)&&(this._context.translate(n.x,n.y),this._context.scale(i.x,i.y),this._context.translate(-n.x,-n.y)),this._context.globalAlpha=t.opacity(),this._context.globalCompositeOperation=t.composite(),t.getDisplayType()){case"rectangle":this.renderRectangle(t);break;case"line":this.renderLine(t);break;case"sprite":this.renderSprite(t)}this._context.restore()},t.prototype.renderRectangle=function(t){var e=t.dimensions();this._context.save(),this._context.fillStyle=t.fillColor(),this._context.fillRect(0,0,e.x,e.y),this._context.restore()},t.prototype.renderLine=function(t){var e=t.coordinates();this._context.save(),this._context.strokeStyle=t.color(),this._context.beginPath(),this._context.moveTo(e[0].x,e[0].y);for(var i=1,s=e.length;s>i;i+=1)this._context.lineTo(e[i].x,e[i].y);this._context.stroke(),this._context.restore()},t.prototype.renderSprite=function(t){var e=t.dimensions(),i=t.srcDimensions(),s=t.srcPosition();this._context.drawImage(t.image(),s.x,s.y,i.x,i.y,0,0,e.x,e.y)},t.prototype.getCanvasEl=function(){return this._canvasEl},t}();
SW.Vector=function(){"use strict";var t=function(t,e){this.x="number"==typeof t?t:0,this.y="number"==typeof e?e:0};return t}();
SW.Renderable=function(){"use strict";var t=function(){SW.Unique.call(this),this._position=new SW.Vector,this._velocity=new SW.Vector,this._dimension=new SW.Vector,this._scale=new SW.Vector(1,1),this._rotationOffset=new SW.Vector,this._scaleOffset=new SW.Vector,this._draggable=!1,this._rotation=0,this._opacity=1,this._visible=!0,this._hidden=!1,this._composite="source-over",this._displayType=""};return t.prototype=SW.Util.clone(SW.Unique.prototype),t.prototype.getDisplayType=function(){return this._displayType},t.prototype.position=function(t,i){return void 0===t&&void 0===i?this._position:("number"==typeof t&&(this._position.x=t),"number"==typeof i&&(this._position.y=i),this)},t.prototype.dimensions=function(t,i){return void 0===t&&void 0===i?this._dimension:("number"==typeof t&&(this._dimension.x=t),"number"==typeof i&&(this._dimension.y=i),this)},t.prototype.rotation=function(t){return void 0===t?this._rotation:("number"==typeof t&&(this._rotation=t),this)},t.prototype.rotationOffset=function(t,i){return void 0===t&&void 0===i?this._rotationOffset:("number"==typeof t&&(this._rotationOffset.x=t),"number"==typeof i&&(this._rotationOffset.y=i),this)},t.prototype.scale=function(t,i){return void 0===t&&void 0===i?this._scale:("number"==typeof t&&(this._scale.x=t),"number"==typeof i&&(this._scale.y=i),this)},t.prototype.scaleOffset=function(t,i){return void 0===t&&void 0===i?this._scale:("number"==typeof t&&(this._scaleOffset.x=t),"number"==typeof i&&(this._scaleOffset.y=i),this)},t.prototype.draggable=function(t){return void 0===t?this._draggable:("boolean"==typeof t&&(this._draggable=t),this)},t.prototype.opacity=function(t){return void 0===t?this._opacity:("number"==typeof t&&(this._opacity=t),this)},t.prototype.composite=function(t){return void 0===t?this._composite:("number"==typeof t&&(this._composite=t),this)},t.prototype.getOuterPosition=function(){return new SW.Vector(this._position.x+this._dimension.x,this._position.y+this._dimension.y)},t.prototype.getCenterPosition=function(){return new SW.Vector(this._position.x-this._dimension.x/2,this._position.y-this._dimension.y/2)},t.prototype.getHalfDimension=function(){return new SW.Vector(this._dimension.x/2,this._dimension.y/2)},t}();
SW.Rectangle=function(){"use strict";var t=function(){SW.Renderable.call(this),this._fillColor="#000",this._displayType="rectangle"};return t.prototype=SW.Util.clone(SW.Renderable.prototype),t.prototype.fillColor=function(t){return void 0===t?this._fillColor:("string"==typeof t&&(this._fillColor=t),this)},t}();
SW.Line=function(){"use strict";var t=function(){SW.Renderable.call(this),this._coordinates=[],this._color="#000",this._width=1,this._cap="butt",this._displayType="line"};return t.prototype=SW.Util.clone(SW.Renderable.prototype),t.prototype.coordinates=function(){if(!arguments.length)return this._coordinates;for(var t=0,o=arguments.length;o>t;t+=1)this._coordinates[t]=arguments[t];return this},t.prototype.color=function(t){return void 0===t?this._color:("string"==typeof t&&(this._color=t),this)},t}();
SW.Sprite=function(){"use strict";var i=function(){SW.Renderable.call(this),this._image=null,this._srcPosition=new SW.Vector,this._srcDimensions=new SW.Vector,this._displayType="sprite"};return i.prototype=SW.Util.clone(SW.Renderable.prototype),i.prototype.srcPosition=function(i,s){return void 0===i&&void 0===s?this._srcPosition:("number"==typeof i&&(this._srcPosition.x=i),"number"==typeof s&&(this._srcPosition.y=s),this)},i.prototype.srcDimensions=function(i,s){return void 0===i&&void 0===s?this._srcDimensions:("number"==typeof i&&(this._srcDimension.x=i),"number"==typeof s&&(this._srcDimension.y=s),this)},i.prototype.image=function(i){return void 0===i?this._image:("object"==typeof i&&(this._image=i,this._srcDimensions.x||this._srcDimensions.y||(this._srcDimensions.x=this._image.width,this._srcDimensions.y=this._image.height),this._dimension.x||this._dimension.y||(this._dimension.x=this._image.width,this._dimension.y=this._image.height)),this)},i}();
SW.GameDom=function(){var t=function(t){SW.Dom.call(this,t),this.title=t.title,this.bgColor=t.bgColor||"#444",document.title=this.title||"spritewerk game",this._styleElements()};return t.prototype=SW.Util.clone(SW.Dom.prototype),t.prototype._styleElements=function(){var t=document.getElementsByTagName("body")[0];t.style.backgroundColor=this.bgColor,t.style.margin=0,t.style.padding=0},t}();
SW.Layer=function(){"use strict";var t=function(){SW.Collection.call(this),this._scrollFactor=1};return t.prototype=SW.Util.clone(SW.Collection.prototype),t}();
SW.Scene=function(){"use strict";var t=function(t){SW.Collection.call(this,t),t=t||{},this._bgColor=t.bgColor||"#ddd",this._assets=t.assets};return t.prototype=SW.Util.clone(SW.Collection.prototype),t.prototype.bgColor=function(t){return void 0===t?this._bgColor:("string"==typeof t&&(this._bgColor=t),this)},t.prototype.init=function(){},t.prototype.update=function(){},t.prototype.destroy=function(){},t.prototype.press=function(){},t.prototype.dblpress=function(){},t.prototype.pressdown=function(){},t.prototype.pressup=function(){},t.prototype.dragstart=function(){},t.prototype.drag=function(){},t.prototype.dragend=function(){},t.prototype.assets=function(t){return void 0===t?this._assets:("object"==typeof t&&(this._assets=t),this)},t}();
SW.SceneManager=function(){"use strict";var e=function(){var e;SW.Collection.call(this),this._loadingName=null,this._loadingScene=null,this._eventTypes=["press","dblpress","pressdown","pressup","dragstart","drag","dragend"];for(var t=0,n=this._eventTypes.length;n>t;t+=1)e=this._eventTypes[t],SW.Signal.addListener(e,this._handleEvents,this);SW.Signal.addListener("preload/complete",this._onPreloadComplete,this)};return e.prototype=SW.Util.clone(SW.Collection.prototype),e.prototype._handleEvents=function(e){var t=e.detail,n=this.activeScene();n[t.type](t)},e.prototype.addScene=function(e,t){var n=new t,i=n.assets();this._loadingName=e,this._loadingScene=n,SW.Util.hasMembers(i)?SW.MediaManager.preload(i):this._onPreloadComplete()},e.prototype.activeScene=function(e){var t=this.getItemCount()-1;return void 0===e?this.getItemAt(t):("string"==typeof e&&(this.setItemIndex(e,t),SW.Signal.dispatch("scene/activated",{scene:this.getItemAt(t)})),this)},e.prototype._onPreloadComplete=function(){this.addItem(this._loadingName,this._loadingScene),this._loadingScene.init(),SW.Signal.dispatch("scene/activated",{scene:this._loadingScene}),this._loadingName=null,this._loadingScene=null},new e}();
SW.Engine=function(){var t=function(t){this._fps=t.fps,this._now=null,this._then=Date.now(),this._interval=1e3/this._fps,this._delta=null,this._counter=0,this._paused=!1,this._boundUpdate=this._update.bind(this)};return t.prototype.start=function(){this._update()},t.prototype._update=function(){this._paused||requestAnimationFrame(this._boundUpdate),this._now=Date.now(),this._delta=this._now-this._then,this._delta>this._interval&&(this._then=this._now-this._delta%this._interval,this._counter+=1,SW.Signal.dispatch("new/frame",{frame:this._counter}))},t.prototype.pause=function(){this._paused=!0},t.prototype.resume=function(){this._paused=!1,this._update()},t}();
SW.Game=function(){"use strict";var t=function(t,i,n){this._initialSceneName=t,this._InitialScene=i,n=n||{},this._canvasId=n.canvasId,this._width=n.width||600,this._height=n.height||400,this._bindMouseInput=n.bindMouseInput||!0,this._bindTouchInput=n.bindTouchInput||!0,this._title=n.title||"spritewerk game",this._fps=n.fps||60,this._canvasFit=n.canvasFit||!1,this.canvas=null,this.input=null,this.engine=null,SW.Signal.addListener(window,"load",this._onReady,this),SW.Signal.addListener("scene/activated",this._onSceneActivated,this),SW.Signal.addListener("new/frame",this._onNewFrame,this)};return t.prototype._onNewFrame=function(){var t=this,i=SW.SceneManager.activeScene();this.canvas.clearAll().fillAll(i.bgColor()),i.each(function(i){i.each(function(i){t.canvas.render(i)})})},t.prototype._onReady=function(){this.dom=new SW.Dom({title:this._title}),this.canvas=new SW.Canvas({id:this._canvasId,width:this._width,height:this._height,canvasFit:this._canvasFit}),this.input=new SW.Input({eventEl:this.canvas.getCanvasEl(),bindMouseInput:this._bindMouseInput,bindTouchInput:this._bindTouchInput,canvasFit:this._canvasFit}),this.engine=new SW.Engine({fps:this._fps}),SW.SceneManager.addScene(this._initialSceneName,this._InitialScene),SW.Signal.dispatch("spritewerk/ready")},t.prototype._onSceneActivated=function(t){this.engineStarted||this.engine.start(),this.input.setScene(t.detail.scene)},t}();