CustomEvent=window.CustomEvent||function(t,e){e=e||{bubbles:!1,cancelable:!1,detail:void 0};var n=document.createEvent("CustomEvent");return n.initCustomEvent(t,e.bubbles,e.cancelable,e.detail),n},CustomEvent.prototype=window.Event.prototype,Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},s=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,s.prototype=new i,s}),function(){"use strict";function t(t,e,n){s?t.addEventListener(e,n,!1):t.attachEvent(e,n)}function e(t,e,n){s?t.removeEventListener(e,n,!1):t.detachEvent(e,n)}function n(t,e,n){var i,a;s?(a=new CustomEvent(e,{detail:n}),t.dispatchEvent(a)):(i="on"+e,t.fireEvent(i))}function i(t){var e;return e=/^\..+$/.test(t)?document.getElementsByClassName(t.split(".")[1]):/^\#.+$/.test(t)?document.getElementById(t.split("#")[1]):"window"===t?window:"document"===t?document:document.getElementsByTagName(t)}var s="addEventListener"in window,a=document.createElement("div"),o=document.getElementsByTagName("body")[0],r={};a.id="radio-mediator",o.appendChild(a);var h={tuneIn:function(e,n,s,o){var h;if("string"==typeof e&&"function"==typeof n&&(o=s?s:null,s=n,n=e,e=a),"string"==typeof e&&(e=i(e)),o&&(r[n]||(r[n]=[]),h={handler:s,boundHandler:s.bind(o)},r[n].push(h)),e.hasOwnProperty("length")&&e.length>0)for(var c=0;c<e.length;c+=1)t(e[c],n,h?h.boundHandler:s);else t(e,n,h?h.boundHandler:s)},tuneOut:function(t,n,s){if("string"==typeof t&&"function"==typeof n&&(s=n,n=t,t=a),"string"==typeof t&&(t=i(t)),r[n])for(var o=0;o<r[n].length;o+=1)if(s===r[n][o].handler){s=r[n][o].boundHandler,r[n].splice(o,1);break}if(t.hasOwnProperty("length")&&t.length>0)for(var o=0;o<t.length;o+=1)e(t[o],n,s);else e(t,n,s)},broadcast:function(t,e,s){if("string"==typeof t&&"string"!=typeof e&&(s=e,e=t,t=a),"string"==typeof t&&(t=i(t)),t.hasOwnProperty("length")&&t.length>0)for(var o=0;o<t.length;o+=1)n(t[o],e,s);else n(t,e,s)},destroy:function(){}};try{module.exports=h}catch(c){try{define([],h)}catch(c){window.radio=h}}}();var Protos=function(){function t(e){var n,i=e.hasOwnProperty("length")?[]:{};for(n in e)i[n]="object"==typeof e[n]&&null!==e[n]?t(e[n]):e[n];return i}var e=0,n=function(i,s){var a,o=function(n,i){var s;for(s in this)"object"==typeof this[s]&&null!==this[s]&&(this[s]=t(this[s]));for(s in n)void 0!==this[s]&&(this[s]=n[s]);this.uid=e++,this.init&&!i&&this.init(n)};for(a in i)s[a]="object"==typeof i[a]&&null!==i[a]?t(i[a]):i[a];return o.prototype=s,o.extend=function(t){return n(t,new this(null,!0))},o};return n()}(),SW={};SW.Collection=Protos.extend({items:{},sortedItems:[],add:function(t,e){this.items[t]=e,this.sortedItems.push(e)},remove:function(t){var e=this.items[t];this.sortedEach(function(n,i){return e===n?(n=null,this.sortedItems.splice(i,1),this.items[t]=null,delete this.items[t],!0):void 0})},sortedEach:function(t){for(var e=0,n=this.sortedItems.length;n>e;e+=1)t(this.sortedItems[e],e,this.sortedItems)},each:function(t){for(var e in this.items)t(this.items[e],e,this.items)},filter:function(t){var e,n=[];return this.sortedEach(function(i,s,a){e=t(i,s,a),e&&n.push(e)}),n},getCount:function(){return this.sortedItems.length},set:function(t,e){this.items[t]=e},get:function(t){return this.items[t]}}),SW.Renderable=Protos.extend({x:0,y:0,width:null,height:null,scaleX:1,scaleY:1,rotationOffsetX:0,rotationOffsetY:0,scaleOffsetX:0,scaleOffsetY:0,rotation:0,opacity:1,composite:"source-over",getRight:function(){return this.x+this.width},getBottom:function(){return this.y+this.height},getCenterX:function(){return this.x+this.halfWidth()},getCenterY:function(){return this.y+this.halfHeight()},getHalfWidth:function(){return this.width/2},getHalfHeight:function(){return this.height/2}}),SW.State=SW.Collection.extend({active:!0,visible:!0,data:null,canScroll:!1,camera:null,boundingBox:null,backgroundColor:null,walls:null,scrollRegions:null,press:function(){},dblpress:function(){},pressdown:function(){},pressup:function(){},init:function(){radio.tuneIn("inputreceived",this._onInputReceived,this)},_onInputReceived:function(t){var e=100/SW.Input._getScaleFactor()/100,n=t.detail.inputEvent,i=parseInt(this._canvas.style.left,10),s=parseInt(this._canvas.style.top,10),a={domEvent:n};switch(n.hasOwnProperty("touches")?(a.absX=n.touches[0].pageX-i,a.absY=n.touches[0].pageY-s):(a.absX=(n.hasOwnProperty("clientX")?n.clientX:n.screenX)-i,a.absY=(n.hasOwnProperty("clientY")?n.clientY:n.screenY)-s),a.x=a.absX*e,a.y=a.absY*e,a.target=this._getTarget(a),n.type){case"click":case"tap":this.press(a);break;case"dblclick":case"dbltap":this.dblpress(a);break;case"mousedown":case"touchstart":this.pressdown(a);break;case"mouseup":case"touchend":this.pressup(a)}},_getTarget:function(t){var e;return this.sortedEach(function(n){n.sortedEach(function(n){SW.Collision.hitPoint(t.x,t.y,n)&&(e=n)})}),e},setup:function(){},update:function(){},destroy:function(){}}),SW.Config={width:600,height:400,fps:60,stretch:!0,backgroundColor:"#444",bindMouseInput:!0,bindTouchInput:!0,title:"spritewerk game"},SW.Dom=Protos.extend({init:function(){document.title=SW.Config.title,this._styleElements(),SW.Config.stretch&&(radio.tuneIn(window,"resize",this._onWindowResize,this),radio.tuneIn(window,"orientationchange",this._onWindowResize,this))},_onWindowResize:function(){radio.broadcast("screenresize")},_styleElements:function(){var t=document.getElementsByTagName("body")[0];t.style.backgroundColor=SW.Config.backgroundColor,t.style.margin=0,t.style.padding=0}}),SW.Canvas=Protos.extend({canvas:null,width:null,height:null,init:function(){this.canvas=document.getElementById("spritewerk"),this.width=SW.Config.width,this.height=SW.Config.height,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.position="absolute",SW.Config.stretch&&(radio.tuneIn("screenresize",this._onScreenResize,this),this._onScreenResize())},_onScreenResize:function(){var t,e,n=SW.Config.height/SW.Config.width,i=SW.Config.width/SW.Config.height,s=i>n?!0:!1,a=window.innerWidth,o=window.innerHeight,r=o/a,h=a/o,c=0,d=0;s?r>n?(t=a,e=t*n,d=(o-e)/2):(e=o,t=o*i,c=(a-t)/2):h>i?(e=o,t=o*i,c=(a-t)/2):(t=a,e=t*n,d=(o-e)/2),this.canvas.style.width=Math.round(t)+"px",this.canvas.style.height=Math.round(e)+"px",this.canvas.style.left=Math.round(c)+"px",this.canvas.style.top=Math.round(d)+"px"},getCanvas:function(){return this.canvas}}),SW.Input=Protos.extend({canvas:null,init:function(){this.canvas=SW.Canvas.getCanvas(),SW.Config.bindMouseInput&&(radio.tuneIn(this.canvas,"click",this._receiveEvent),radio.tuneIn(this.canvas,"dblclick",this._receiveEvent),radio.tuneIn(this.canvas,"mousedown",this._receiveEvent),radio.tuneIn(this.canvas,"mouseup",this._receiveEvent)),SW.Config.bindTouchInput&&(radio.tuneIn(this.canvas,"tap",this._receiveEvent),radio.tuneIn(this.canvas,"dbltap",this._receiveEvent),radio.tuneIn(this.canvas,"touchstart",this._receiveEvent),radio.tuneIn(this.canvas,"touchend",this._receiveEvent))},_getScaleFactor:function(){var t,e=1;return this.canvas.style.width&&(t=parseInt(this.canvas.style.width,10),e=t/this.canvas.width),e},_receiveEvent:function(t){radio.broadcast("inputreceived",{inputEvent:t})}}),SW.Draw=Protos.extend({canvas:null,context:null,init:function(){this.canvas=SW.Canvas.getCanvas(),this.context=this.canvas.getContext("2d")},clear:function(){return this.context.clearRect(0,0,this.canvas.width,this.canvas.height),this},fill:function(t){return this.context.save(),this.context.fillStyle=t,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),this.context.restore(),this},render:function(t){switch(this.context.save(),this.context.translate(t.x,t.y),0!==t.rotation&&(this.context.translate(t.rotationOffsetX,t.rotationOffsetY),this.context.rotate(Math.PI/180*t.rotation),this.context.translate(-t.rotationOffsetX,-t.rotationOffsetY)),(1!==t.scaleX||1!==t.scaleY)&&(this.context.translate(t.scaleOffsetX,t.scaleOffsetY),this.context.scale(t.scaleX,t.scaleY),this.context.translate(-t.scaleOffsetX,-t.scaleOffsetY)),this.context.globalAlpha=t.opacity,this.context.globalCompositeOperation=t.composite,t.displayType){case"rectangle":this._renderRectangle(t);break;case"sprite":this._renderSprite(t)}this.context.restore()},_renderRectangle:function(t){this.context.fillStyle=t.fill,this.context.fillRect(0,0,t.width,t.height)},_renderSprite:function(t){this.context.drawImage(t.img,t.srcX,t.srcY,t.srcWidth,t.srcHeight,0,0,t.width,t.height)}}),SW.FSM=SW.Collection.extend({beingLoaded:{name:null,data:null},init:function(){this.add("loading",SW.Loading),radio.tuneIn("preloadcomplete",this._onPreloadComplete,this)},add:function(t,e){this.get("loading")&&this.setActive("loading"),this.beingLoaded.name=t,this.beingLoaded.state=new e,this.beingLoaded.state.data.assets?new SW.Preloader({assets:this.beingLoaded.state.data.assets}):this._onPreloadComplete()},remove:function(t){var e=this.get(t);radio.tuneOut("inputreceived",e._onInputReceived),SW.Collection.prototype.remove.call(this,t)},_onPreloadComplete:function(){var t,e,n,i,s=this.beingLoaded.state,a=s.data;s.config=a.config;for(var o=0,r=a.groups.length;r>o;o+=1){t=a.groups[o],s.add(t.name,new SW.Collection);for(var h=0,c=t.entities.length;c>h;h+=1)n=t.entities[h],n.config.imageName&&(n.config.img=SW.MediaManager.images[n.config.imageName]),e=new n.type(n.config),i=n.name?n.name:e.displayType+e._uid,s.get(t.name).add(i,e)}s.data=null,delete s.data,s.setup(),SW.Collection.prototype.add.call(this,this.beingLoaded.name,s),this.setActive(this.beingLoaded.name)},getActive:function(){return this.sortedItems[this.getCount()-1]},setActive:function(t){var e=this.get(t);return e?1===this.getCount()?(e.active=!0,e.visible=!0,!1):void this.sortedEach(function(t,n,i){e===t?(t.active=!0,t.visible=!0,n<i.length-1&&(this.sortedItems.splice(n,1),this.sortedItems.push(t))):(t.active=!1,t.visible=!1)}):!1}}),SW.Game=Protos.extend({frame:0,start:function(t,e){t&&e&&SW.FSM.add(t,e),this.scopedUpdate=this._update.bind(this),this._update()},_update:function(){SW.FSM.sortedEach(function(t){SW.Draw.clear(),t.active&&t.update(),t.visible&&(SW.Draw.clear().fill(t.config.bgColor),t.sortedEach(function(t){t.sortedEach(function(t){SW.Draw.render(t)})}))}),radio.broadcast("newframe",{detail:{frame:++this.frame}}),requestAnimationFrame(this.scopedUpdate)}}),SW.MediaManager=Protos.extend({images:{},sounds:{},addImage:function(t,e){this.images[t]=e},addSound:function(t,e){this.sounds[t]=e},play:function(t){var e=this.sounds[t];e.currentTime=0,e.play()},pause:function(t){var e=this.sounds[t];e.pause()},resume:function(){var t=this.sounds[name];t.play()},pauseAll:function(){for(var t in this.sounds)this.sounds[t].pause()}}),SW.Preloader=Protos.extend({assets:null,total:0,loaded:0,init:function(t){var e;this.assets=t.assets;for(e in this.assets)this.total+=1;for(e in this.assets)if(this.assets[e].indexOf(".png")>0||this.assets[e].indexOf(".jpg")>0){var n=new Image;n.src=this.assets[e],radio.tuneIn(n,"load",this.loadHandler,this),radio.tuneIn(n,"error",this.error,this)}else if(this.assets[e].indexOf(".mp3")>0||this.assets[e].indexOf(".wav")>0||this.assets[e].indexOf(".ogg")>0){var i=new Audio;i.src=this.assets[e],radio.tuneIn(i,"canplaythrough",this.loadHandler,this),radio.tuneIn(i,"error",this.error,this)}},tuneOutCurrent:function(t){var e,n=t.tagName.toLowerCase();if("img"==n){if(radio.tuneOut(t,"load",this.loadHandler),radio.tuneOut(t,"error",this.error),SW.MediaManager)for(e in this.assets)this.getFileName(this.assets[e])===this.getFileName(t.src)&&SW.MediaManager.addImage(e,t)}else if("audio"==n&&(radio.tuneOut(t,"canplaythrough",this.loadHandler),radio.tuneOut(t,"error",this.error),SW.MediaManager))for(e in this.assets)this.getFileName(this.assets[e])===this.getFileName(t.src)&&SW.MediaManager.addSound(e,t)},loadHandler:function(t){this.tuneOutCurrent(t.currentTarget),this.loaded+=1,this.loaded===this.total?radio.broadcast("preloadcomplete"):radio.broadcast("preloadupdate",{detail:{loaded:this.loaded,total:this.total}})},error:function(t){console.log(t.status)},getFileName:function(t){return t.substring(t.lastIndexOf("/")+1,t.length+1)}}),SW.Rectangle=SW.Renderable.extend({fill:"#000",displayType:"rectangle"}),SW.Sprite=SW.Renderable.extend({img:null,imageName:null,srcX:0,srcY:0,srcWidth:null,srcHeight:null,displayType:"sprite",init:function(){this.img&&this.setImage()},setImage:function(t){this.img=t||this.img,this.srcWidth||this.srcHeight||(this.srcWidth=this.img.width,this.srcHeight=this.img.height),this.width||this.height||(this.width=this.img.width,this.height=this.img.height)}}),function(){"use strict";var t=24,e=SW.Config.width/2-12,n=SW.Config.height/2-24,i=12,s=36;SW.Loading=SW.State.extend({data:{config:{bgColor:"#000"},groups:[{name:"main",entities:[{name:"spinnerA",type:SW.Rectangle,config:{x:e,y:n,rotationOffsetX:i,rotationOffsetY:s,width:t,height:t,fill:"#CC3"}},{name:"spinnerB",type:SW.Rectangle,config:{x:e,y:n,rotationOffsetX:i,rotationOffsetY:s,rotation:120,width:t,height:t,fill:"#C3C"}},{name:"spinnerC",type:SW.Rectangle,config:{x:e,y:n,rotationOffsetX:i,rotationOffsetY:s,rotation:240,width:t,height:t,fill:"#3CC"}}]}]},setup:function(){this.spinnerA=this.get("main").get("spinnerA"),this.spinnerB=this.get("main").get("spinnerB"),this.spinnerC=this.get("main").get("spinnerC")},update:function(){this.spinnerA.rotation+=4,this.spinnerB.rotation+=4,this.spinnerC.rotation+=4}})}(),function(){"use strict";function t(){radio.tuneOut(window,"load",t),SW.MediaManager=new SW.MediaManager,SW.Dom=new SW.Dom,SW.Canvas=new SW.Canvas,SW.Draw=new SW.Draw,SW.Input=new SW.Input,SW.FSM=new SW.FSM,SW.Game=new SW.Game,radio.broadcast("spritewerkready")}radio.tuneIn(window,"load",t)}();