<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: state-control.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: state-control.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * sets up state objects
 *
 * @class StateControl
 * @static
 */
define([
    '../lib/preloader',
    '../lib/radio',
    './layer'
], function(preloader, radio, Layer) {
    return {
        /**
         * @member {object} StateControl._state - instance of current state
         * @private
         */
        _state: null,

        /**
         * @member {constructor} StateControl._State - current state constructor
         * @private
         */
        _State: null,

        /**
         * @member {boolean} StateControl._loadingState - true when loading a state
         * @private
         */
        _loadingState: false,

        init: function() {
            radio.tuneIn('newframe', this.update, this);
        },

        /**
         * if not currently loading, call state's update function
         *
         * @method StateControl.update
         */
        update: function() {
            if (! this._loadingState) {
                this._state.update();
            }
        },

        /**
         * executes after assets are preloaded
         *
         * @method StateControl._onAssetsLoaded
         * @private
         */
        _onAssetsLoaded: function() {
            var stateLayers = [];
            var layer;
            var entity;
            var parsedEntity;

            radio.tuneOut(document, 'preloader/assetsloaded', this._onAssetsLoaded);

            for (var layerInd = 0; layerInd &lt; this._data.layers.length; layerInd += 1) {
                stateLayers[layerInd] = new Layer();
                layer = this._data.layers[layerInd];

                for (var entityInd = 0; entityInd &lt; layer.entities.length; entityInd += 1) {
                    entity = layer.entities[entityInd];

                    parsedEntity = new entity.type(entity.config);
                    parsedEntity.name = entity.name;

                    if (parsedEntity.src) {
                        parsedEntity.attachImage();
                    }

                    stateLayers[layerInd].entities[entityInd] = parsedEntity;
                }
            }

            // initialize state
            this._state = new this._State({
                layers: stateLayers,
                backgroundColor: this._data.backgroundColor
            });

            this._loadingState = false;
        },

        /**
         * @method StateControl.setState
         * @param {constructor} State
         * @param {object} data
         */
        setState: function(State, data) {
            this._State = State;
            this._data = data;
            this._loadingState = true;

            if (data.assets.length) {
                radio.tuneIn(document, 'preloader/assetsloaded', this._onAssetsLoaded, this);
                preloader.load(data.assets);
            } else {
                this._onAssetsLoaded();
            }
        },

        /**
         * @method StateControl.getState
         */
        getState: function() {
            this._state;
        }
    };
});</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="Config.html">Config</a></li><li><a href="Crud.html">Crud</a></li><li><a href="DomControl.html">DomControl</a></li><li><a href="Draw.html">Draw</a></li><li><a href="Engine.html">Engine</a></li><li><a href="Game.html">Game</a></li><li><a href="Input.html">Input</a></li><li><a href="Layer.html">Layer</a></li><li><a href="Observable.html">Observable</a></li><li><a href="Sprite.html">Sprite</a></li><li><a href="State.html">State</a></li><li><a href="StateControl.html">StateControl</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-alpha10</a> on Sun Nov 09 2014 23:26:13 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
