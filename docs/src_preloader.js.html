<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/preloader.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: src/preloader.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>SW._Preloader = (function() {
    /**
     * @class SW._Preloader
     * @belongsto SW
     * @param {object} assets
     * @private
     */
    var _Preloader = function(assets) {
        var prop;

        /**
         * @member {object} SW._Preloader.prototype.assets
         * @private
         */
        this.assets = assets;

        /**
         * @member {integer} SW._Preloader.prototype.total
         * @private
         */
        this.total = 0;

        /**
         * @member {integer} SW._Preloader.prototype.loaded
         * @private
         */
        this.loaded = 0;

        for(prop in this.assets) {
            this.total += 1;
        }

        for (prop in this.assets) {
            if (this.assets[prop].indexOf('.png') > 0 || this.assets[prop].indexOf('.jpg') > 0 || this.assets[prop].indexOf('.gif') > 0) {
                var img = new Image();
                img.src = this.assets[prop];

                SW.Radio.tuneIn(img, 'load',  this._loadHandler, this);
                SW.Radio.tuneIn(img, 'error', this._error, this);
            } else if (this.assets[prop].indexOf('.mp3') > 0 || this.assets[prop].indexOf('.wav') > 0 || this.assets[prop].indexOf('.ogg') > 0) {
                var audio = new Audio();
                audio.src = this.assets[prop];

                SW.Radio.tuneIn(audio, 'canplaythrough', this._loadHandler, this);
                SW.Radio.tuneIn(audio, 'error', this._error, this);
            } else {
                throw new Error('File type not supported');
            }
        }
    };

    /**
     * @method SW._Preloader.prototype._tuneOutCurrent
     * @private
     */
    _Preloader.prototype._tuneOutCurrent = function(el) {
        var type = el.tagName.toLowerCase();

        if (type == 'img') {
            SW.Radio.tuneOut(el, 'load',  this._loadHandler);
            SW.Radio.tuneOut(el, 'error', this._error);
        } else if (type == 'audio') {
            SW.Radio.tuneOut(el, 'canplaythrough', this._loadHandler);
            SW.Radio.tuneOut(el, 'error', this._error);
        }
    };

    /**
     * @method SW._Preloader.prototype._loadHandler
     * @fires SW.Radio#preload/update
     * @fires SW.Radio#preload/complete
     * @private
     */
    _Preloader.prototype._loadHandler = function(e) {
        var el = e.currentTarget;
        var type = el.tagName.toLowerCase();
        var assetName;

        this._tuneOutCurrent(el);

        this.loaded += 1;

        for(var name in this.assets) {
            if (this._getFileName(this.assets[name]) === this._getFileName(el.src)) {
                assetName = name;
            }
        }

        /**
         * reports that an asset has been successfully preloaded
         *
         * @event SW.Radio#preload/update
         * @property {HTMLElement} el
         * @property {string} name
         * @property {integer} loaded
         * @property {integer} total
         */
        SW.Radio.broadcast('preload/update', {
            loaded: this.loaded,
            total : this.total,
            name: assetName,
            el: el,
            type: type
        });

        if (this.loaded === this.total) {
            /**
             * reports that all assets have been successfully preloaded
             *
             * @event SW.Radio#preload/complete
             */
            SW.Radio.broadcast('preload/complete');
        }
    };

    /**
     * @method SW._Preloader.prototype._error
     * @private
     */
    _Preloader.prototype._error = function(e) {
        if ('console' in window) {
            console.log(e);
        }
    };

    /**
     * @method SW._Preloader.prototype._getFileName
     * @param {string} path
     * @private
     */
    _Preloader.prototype._getFileName = function(path) {
        return path.substring(path.lastIndexOf('/') + 1, path.length + 1);
    };

    return _Preloader;
}());</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SW._Preloader.html">_Preloader</a></li><li><a href="SW.Base.html">Base</a></li><li><a href="SW.Canvas.html">Canvas</a></li><li><a href="SW.Collection.html">Collection</a></li><li><a href="SW.Config.html">Config</a></li><li><a href="SW.Dom.html">Dom</a></li><li><a href="SW.Input.html">Input</a></li><li><a href="SW.MediaManager.html">MediaManager</a></li><li><a href="SW.Movable.html">Movable</a></li><li><a href="SW.Radio.html">Radio</a></li><li><a href="SW.Renderable.html">Renderable</a></li><li><a href="SW.Unique.html">Unique</a></li><li><a href="SW.Util.html">Util</a></li></ul><h3>Events</h3><ul><li><a href="SW.Radio.html#event:dblpress">dblpress</a></li><li><a href="SW.Radio.html#event:preload/complete">preload/complete</a></li><li><a href="SW.Radio.html#event:preload/update">preload/update</a></li><li><a href="SW.Radio.html#event:press">press</a></li><li><a href="SW.Radio.html#event:pressdown">pressdown</a></li><li><a href="SW.Radio.html#event:pressup">pressup</a></li><li><a href="SW.Radio.html#event:screen/resize">screen/resize</a></li><li><a href="SW.Radio.html#event:spritewerk/ready">spritewerk/ready</a></li></ul><h3>Namespaces</h3><ul><li><a href="SW.html">SW</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.0-beta1</a> on Wed Feb 25 2015 22:08:30 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
